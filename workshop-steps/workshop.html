<!DOCTYPE html>
<!-- saved from url=(0060)http://getbootstrap.com/2.3.2/examples/starter-template.html -->
<html lang="fr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <title>Streaming Data Workshop</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!-- Le styles -->
  <link href="styles/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="styles/idea.css">
  <style type="text/css">
    body {
      padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
    }
    section {
      padding-bottom: 40px;
    }
    li {
      margin: 10px;
    }
    pre {
      background-color: white;
    }
  </style>
  <script src="js/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
</head>

<body cz-shortcut-listen="true">

<div class="navbar navbar-inverse navbar-fixed-top">
  <div class="navbar-inner">
    <div class="container">
      <a class="navbar-brand" href="#">
        Streaming Data Workshop
      </a>
      <div class="nav-collapse collapse">
        <ul class="nav">
        </ul>
      </div><!--/.nav-collapse -->
    </div>
  </div>
</div>

<div class="container">
  <h1>Playground</h1>

  <p>We will start with a warmup for those that are not familiar with <strong>Vert.x</strong>, <strong>Infinispan</strong> and <strong>Openshift</strong>.</p>
  <p>If you ave already played or worked with these frameworks before, you can skip this part.</p>

  <h2>Ex1 :: Start Openshift and Create an Infinispan Cluster</h2>
  <section id="openshift">
    <img src="img/openshift.png" alt="Openshift" class="img-rounded" height="30%" width="30%">
    <ul style="list-style: decimal;">
      <li>Start a cluster with the service catalog</li>
      <pre><code>> cd streaming-data-workshop
> ./start-openshift.sh</code></pre>
      <li>Log in into <a href="https://127.0.0.1:8443" target="_blank">Openshift console</a> with <code>developer/developer</code></li>
      <li>Click in "browse catalog"</li>
    </ul>
    <img src="img/openshift-catalog.png" alt="simple web app" class="img-rounded"/>
  </section>

  <section id="infinispan">
    <img src="img/infinispan9_pixelsizes_600.gif" alt="Infinispan" class="img-rounded" height="20%" width="20%">
    <ul style="list-style: decimal;">
      <li>In openshift catalog, choose <kbd>Infinispan Ephemeral</kbd></li>
      <li>Add the following configuration :
          <pre><code>APPLICATION_NAME=datagrid
NUMBER_OF_INSTANCES=3
MANAGEMENT_USER/MANAGEMENT_PASSWORD=developer/developer</code></pre>
      </li>
      <li>Click <kbd>Next</kbd></li>
      <li>Click <kbd>Create</kbd></li>
      <li>Go to <kbd>My project</kbd></li>
      <li>You should see <kbd>datagrid</kbd> deployment with <kbd>3 pods</kbd> and <kbd>3 services</kbd> : datagrid-hotrod, datagrid-http and datagrid-management</li>
      <img src="img/datagrid-pods.png" alt="pods" class="img-rounded"/>
    </ul>
    <div class="alert alert-warning">You can deploy de cluster easily from command line :</div>
      <pre><code>cd streaming-data-workshop
./start-datagrid.sh</code></pre>
  </section>

  <h2>Ex2 :: Vert.x and Infinispan Intro</h2>
  <p>In this section you will learn how to create REST endpoints using vert.x and how to comunicate remotely with a cache.</p>
  <section id="vert.x">
    <img src="img/Vert.x_Logo.svg.png" alt="Vert.x" class="img-rounded" height="15%" width="15%">
    <ul style="list-style: decimal;">
      <li>In the project, open <kbd>simple-web-application module</kbd></li>
      <li>Create your first Verticle.
        <ul>
          <li>Extend the class from <code>AbstractVerticle</code></li>
          <li>Override <code>start</code> method</li>
          <li>Create a Router with <code>Router router = Router.router(vertx);</code></li>
          <li>Create an empty <kbd>GET</kbd> endpoint that will respond <code>Welcome</code> from the Router</li>
          <li>Create a <kbd>GET</kbd> endpoint in <code>/api</code> that responds
            <pre><code class="json">{"name":"duchess","version":1}</code></pre>
            using <pre><code class="java">new JsonObject().put("name", "duchess").put("version", 1).encode()</code></pre>
          </li>
          <li>Create a <code>HttpServer</code> with vertx object with requestHandler <code>router::accept</code> and listening to port <code>8080</code></li>
        </ul>
        <br/>
        <a class="btn btn-info" role="button" onclick="$('#array-sol-1').toggle();">Show/Hide Solution</a>
        <div id="array-sol-1" style="display:none;">
        <pre>
          <code class="java">package workshop.playgroud;

import io.vertx.core.AbstractVerticle;
import io.vertx.core.Future;
import io.vertx.core.Vertx;
import io.vertx.core.json.JsonObject;
import io.vertx.ext.web.Router;

public class PlayWithTheCache extends AbstractVerticle {

  @Override
  public void start() throws Exception {
    Router router = Router.router(vertx);

    router.get("/").handler(rc -> {
      rc.response().end("Welcome");
    });

    router.get("/api").handler(rc -> {
      rc.response().end(new JsonObject().put("name", "duchess").put("version", 1).encode());
    });

    vertx.createHttpServer()
      .requestHandler(router::accept)
      .listen(8080);
  }
}</code>
        </pre>
      </div>
      </li>
      <li>Deploy with <code>./deploy.sh</code></li>
      <img src="img/simple-web-app.png" alt="simple web app" class="img-rounded"/>
      <li>Go to <a target="_target" href="http://simple-web-app-myproject.127.0.0.1.nip.io">Welcome endpoint</a></li>
      <li>Go to <a target="_target" href="http://simple-web-app-myproject.127.0.0.1.nip.io/api">Api endpoint</a></li>
      <li> Connect with Infinispan
        <ul>
          <li>Init the <code>RemoteCacheManager</code> with <pre><code class="java">new ConfigurationBuilder().addServer()
          .host(DATAGRID_HOST) // contains the value datagrid-hotrod that is a service in Openshfitt
          .port(DATAGRID_PORT) // contains the hotrod point 11222
          .build())</code></pre></li>
          <li>Init the <code>defaultCache</code> calling <code>remoteCacheManager.getCache()</code></li>
          <li>Add the <kbd>POST</kbd> <code>router.post("/api/duchess").handler(this::handleAddDuchess);</code></li>
          <li>Implement <code>handleAddDuchess</code> so that it takes the <code>id</code> and the <code>value</code> in the body
            using <code>rc.getBodyAsJson()</code> and <code>defaultCache.putAsync(k,v)</code></li>
          <li>Add the <kbd>GET</kbd> <code>router.get("/api/duchess/:id").handler(this::handleGetDuchess);</code></li>
          <li>Implement <code>handleGetDuchess</code> so that it takes the <code>id</code> using <code>rc.request().getParam</code> and <code>defaultCache.getAsync(k)</code></li>
        </ul>
      <br/>
        <a class="btn btn-info" role="button" onclick="$('#array-sol-2').toggle();">Show/Hide Solution</a>
        <div id="array-sol-2" style="display:none;">
        <pre>
          <code class="java"> SOLUTION HERE
</code>
        </pre>
        </div>
      </li>
      <li>Redeploy with <code>./redeploy.sh</code></li>
      <li>Test <kbd>POST</kbd> with <code>curl ...</code></li>
      <li>Test <kbd>GET</kbd> with <code>curl -X GET -i -H "Accept: application/json" http://simple-web-app-myproject.127.0.0.1.nip.io/api/duchess/1</code></li>
    </ul>
  </section>

  <h1>Streaming Data</h1>

  <h2>Ex3 :: Start</h2>
  <ul>
    <li>
      <p> Run <code>./start-all.sh</code></p>
      <div class="alert alert-info">This will start Openshift, Deploy the Datagrid and Deploy all the components involved in the workshop</div>
    </li>
    <li>Go to the board : <a href="http://localhost:3000/" target="_target">front-end app</a></li>
  </ul>


  <h2>Ex4 :: Collect data</h2>

  <p>In this section we are going to import in a reactive and real-time way a file that contains data.
  This code would work connecting to a remote web-service or any other data source. The data collected in the files are real data coming from
  an real API on Swiss Transport.</p>

  <h3>Deploy Infinispan Visualizer</h3>
  <section id="visualizer">
    <ul>
      <li><code>cd datagrid-visualizer</code>/li>
      <li><code>./deploy.sh</code></li>
      <li>Go to <a href="http://datagrid-visualizer-myproject.127.0.0.1.nip.io/infinispan-visualizer/" target="_target">See the visualizer runnnig</a></li>
    </ul>
  </section>

  <h3>Make injection work</h3>

  <section id="inject">
    <img src="img/collectionLayer.png" alt="Collection Layer" class="img-rounded">
    <ul style="list-style: decimal;">
      <li>Open <kbd>StationsInjector</kbd></li>
    </ul>
  </section>


  <h2>Ex5 :: Transport data</h2>

  <p>Delayed Trains Listener</p>

  <section id="transport">
    <img src="img/transportLayer.png" alt="Transport Layer" class="img-rounded">
    <ul style="list-style: decimal;">
      <li>Open <kbd>DelayedListener</kbd></li>
    </ul>
  </section>


  <h2>Ex6 :: Delayed trains positions</h2>

  <section id="inmemory">
    <img src="img/InMemoryLayer.png" alt="Inmemory Layer" class="img-rounded">
    <ul style="list-style: decimal;">
      <li>Open <kbd>DelayedTrains</kbd></li>
    </ul>
  </section>

  <h2>Ex7 :: Delayed trains Dashboard</h2>

  <section id="dashboard">
    <ul style="list-style: decimal;">
      <li>Open <kbd>DelayedDashboard</kbd></li>
    </ul>
  </section>


</div> <!-- /container -->
<br/><br/>

<script type="text/javascript" src="js/jquery-3.2.1.min.js"></script>

</body></html>
